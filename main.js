(()=>{"use strict";var t={baseUrl:"https://nomoreparties.co/v1/plus-cohort-9",headers:{authorization:"178f9d6a-33c6-4fd5-a1f0-54c79917b762","Content-Type":"application/json"}};function e(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}var n=document.querySelector(".page"),r=n.querySelector(".profile__toggle"),o=n.querySelector(".profile__avatar-container"),c=n.querySelector(".popup_type_profile"),a=n.querySelector(".popup_type_add-pic"),i=n.querySelector(".popup_type_full-pic"),l=n.querySelector(".popup_type_delete-pic"),u=n.querySelector(".popup_type_add-avatar"),s=n.querySelector(".profile__add-button"),d=document.forms.profile,f=document.forms.card,p=document.forms.avatar,_=n.querySelector(".profile__title"),h=n.querySelector(".profile__subtitle"),m=n.querySelector(".profile__avatar"),v=d.elements.name,y=d.elements.job,b=p.elements.url,S=n.querySelector(".photo-grid__list"),g=n.querySelector(".card-template").content,C=n.querySelector(".form__button_small"),L=n.querySelector(".profile__avatar"),q=(n.querySelectorAll(".form__button"),{formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_inactive",inputErrorClass:"form__item_type_error",errorClass:"form__item-error_active"});function E(t){"Escape"===t.key&&x(document.querySelector(".popup_opened"))}function k(t){t.classList.add("popup_opened"),document.addEventListener("keydown",E)}function x(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",E)}function A(t,e){(t.target.classList.contains("popup")||t.target.classList.contains("popup__toggle"))&&x(e)}function U(t,e,n){e.textContent=t.likes.length,n.classList.toggle("photo-grid__button_active")}function w(n,r,o,c,a,u,s){var d=g.querySelector(".photo-grid__card").cloneNode(!0),f=d.querySelector(".photo-grid__image"),p=d.querySelector(".photo-grid__title"),_=d.querySelector(".photo-grid__button"),h=d.querySelector(".photo-grid__trash"),m=d.querySelector(".photo-grid__like"),v=i.querySelector(".popup__image"),y=i.querySelector(".popup__title");return f.src=r,f.alt=n,p.textContent=n,m.textContent=u,o!==c?h.classList.add("photo-grid__trash_inactive"):h.addEventListener("click",(function(){k(l),function(n,r){C.addEventListener("click",(function(){(function(n){return fetch("".concat(t.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:t.headers}).then(e)})(n).then((function(){!function(t){t.remove()}(r),x(l)})).catch((function(t){console.log(t)}))}))}(a,d)})),function(t,e){return e.some((function(e){return e._id===t}))}(c,s)&&_.classList.toggle("photo-grid__button_active"),_.addEventListener("click",(function(){!function(n,r,o){o.classList.contains("photo-grid__button_active")?function(n){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:t.headers}).then(e)}(n).then((function(t){U(t,r,o)})).catch((function(t){console.log(t)})):function(n){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:t.headers}).then(e)}(n).then((function(t){U(t,r,o)})).catch((function(t){console.log(t)}))}(a,m,_)})),f.addEventListener("click",(function(){k(i),v.src=f.src,v.alt=f.alt,y.textContent=f.alt})),d}function T(t,e){e.prepend(t)}var j=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(n.inactiveButtonClass),e.removeAttribute("disabled")):(e.classList.add(n.inactiveButtonClass),e.setAttribute("disabled",!0))};function O(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}Promise.all([fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then(e),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then(e)]).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c=[],a=!0,i=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(c.push(r.value),!e||c.length!==e);a=!0);}catch(t){i=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(i)throw o}}return c}}(e,n)||function(t,e){if(t){if("string"==typeof t)return O(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],c=r[1];_.textContent=o.name,h.textContent=o.about,m.src=o.avatar;var a=o._id;c.reverse().forEach((function(t){T(w(t.name,t.link,t.owner._id,a,t._id,t.likes.length,t.likes),S)}))})).catch((function(t){Sconsole.log(t)})),r.addEventListener("click",(function(){k(c),v.value=_.textContent,y.value=h.textContent})),c.addEventListener("click",(function(t){A(t,c)})),o.addEventListener("click",(function(){k(u)})),u.addEventListener("click",(function(t){A(t,u)})),s.addEventListener("click",(function(){k(a)})),a.addEventListener("click",(function(t){A(t,a)})),i.addEventListener("click",(function(t){A(t,i)})),l.addEventListener("click",(function(t){A(t,l)})),d.addEventListener("submit",(function(n){n.preventDefault();var r=n.submitter,o=r.textContent;r.textContent="Сохранение...",function(n,r){return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:n.value,about:r.value})}).then(e)}(v,y).then((function(t){_.textContent=t.name,h.textContent=t.about,x(c)})).catch((function(t){console.log(t)})).finally((function(){r.textContent=o}))})),u.addEventListener("submit",(function(n){n.preventDefault();var r=n.submitter,o=r.textContent;r.textContent="Сохранение...",function(n){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n.value})}).then(e)}(b).then((function(t){L.src=t.avatar,x(u)})).catch((function(t){console.log(t)})).finally((function(){r.textContent=o}))})),f.addEventListener("submit",(function(n){n.preventDefault();var r,o,c=f.elements.place,i=f.elements.url,l=n.submitter,u=l.textContent;l.textContent="Сохранение...",(r=c,o=i,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:r.value,link:o.value})}).then(e)).then((function(t){T(w(t.name,t.link,t.owner._id,t.owner._id,t._id,t.likes.length,t.likes),S),x(a),c.value="",i.value="";var e=Array.from(f.querySelectorAll(".form__item"));j(e,l,q)})).catch((function(t){console.log(t)})).finally((function(){l.textContent=u}))})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);j(n,r,e),n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){e.validity.valid?function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(t,e,n):function(t,e,n,r){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(t,e,e.validationMessage,n)}(t,o,e),j(n,r,e)}))}))}(e,t)}))}(q)})();