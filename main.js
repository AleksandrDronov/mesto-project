(()=>{"use strict";var t={baseUrl:"https://nomoreparties.co/v1/plus-cohort-9",headers:{authorization:"178f9d6a-33c6-4fd5-a1f0-54c79917b762","Content-Type":"application/json"}};function e(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}var n=new Promise((function(n,o){fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then(e).then((function(t){n(t)})).catch((function(t){console.log(t),o()}))})),o=new Promise((function(n,o){fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then(e).then((function(t){n(t)})).catch((function(t){console.log(t),o()}))})),r=document.querySelector(".page"),c=r.querySelector(".profile__toggle"),i=r.querySelector(".profile__avatar-container"),a=r.querySelector(".popup_type_profile"),l=r.querySelector(".popup_type_add-pic"),u=r.querySelector(".popup_type_full-pic"),s=r.querySelector(".popup_type_delete-pic"),d=r.querySelector(".popup_type_add-avatar"),f=r.querySelector(".profile__add-button"),p=document.forms.profile,h=document.forms.card,_=document.forms.avatar,m=r.querySelector(".profile__title"),v=r.querySelector(".profile__subtitle"),y=r.querySelector(".profile__avatar"),b=p.elements.name,S=p.elements.job,g=_.elements.url,C=r.querySelector(".photo-grid__list"),L=r.querySelector(".card-template").content,q=r.querySelector(".form__button_small"),E=r.querySelector(".profile__avatar"),k=(r.querySelectorAll(".form__button"),{formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_inactive",inputErrorClass:"form__item_type_error",errorClass:"form__item-error_active"});function x(t){"Escape"===t.key&&w(document.querySelector(".popup_opened"))}function A(t){t.classList.add("popup_opened"),document.addEventListener("keydown",x)}function w(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",x)}function U(t,e){(t.target.classList.contains("popup")||t.target.classList.contains("popup__toggle"))&&w(e)}function P(t,e,n){e.textContent=t.likes.length,n.classList.toggle("photo-grid__button_active")}function T(n,o,r,c,i,a,l){var d=L.querySelector(".photo-grid__card").cloneNode(!0),f=d.querySelector(".photo-grid__image"),p=d.querySelector(".photo-grid__title"),h=d.querySelector(".photo-grid__button"),_=d.querySelector(".photo-grid__trash"),m=d.querySelector(".photo-grid__like"),v=u.querySelector(".popup__image"),y=u.querySelector(".popup__title");return f.src=o,f.alt=n,p.textContent=n,m.textContent=a,r!==c?_.classList.add("photo-grid__trash_inactive"):_.addEventListener("click",(function(){A(s),function(n,o){q.addEventListener("click",(function(){(function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers})})(n).then(e).then((function(){!function(t){t.remove()}(o)})).catch((function(t){console.log(t)})),w(s)}))}(i,d)})),function(t,e){return e.some((function(e){return e._id===t}))}(c,l)&&h.classList.toggle("photo-grid__button_active"),h.addEventListener("click",(function(){!function(n,o,r){r.classList.contains("photo-grid__button_active")?function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers})}(n).then(e).then((function(t){P(t,o,r)})).catch((function(t){console.log(t)})):function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers})}(n).then(e).then((function(t){P(t,o,r)})).catch((function(t){console.log(t)}))}(i,m,h)})),f.addEventListener("click",(function(){A(u),v.src=f.src,v.alt=f.alt,y.textContent=f.alt})),d}function j(t,e){e.prepend(t)}var O=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(n.inactiveButtonClass),e.removeAttribute("disabled")):(e.classList.add(n.inactiveButtonClass),e.setAttribute("disabled",!0))};function B(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c=[],i=!0,a=!1;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(c.push(o.value),!e||c.length!==e);i=!0);}catch(t){a=!0,r=t}finally{try{i||null==n.return||n.return()}finally{if(a)throw r}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return D(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}Promise.all([n,o]).then((function(t){var e=B(t,2),n=e[0],o=e[1];m.textContent=n.name,v.textContent=n.about,y.src=n.avatar;var r=n._id;o.reverse().forEach((function(t){j(T(t.name,t.link,t.owner._id,r,t._id,t.likes.length,t.likes),C)})).catch((function(t){var e=B(t,2),n=e[0],o=e[1];console.log(n,o)}))})),c.addEventListener("click",(function(){A(a),b.value=m.textContent,S.value=v.textContent})),a.addEventListener("click",(function(t){U(t,a)})),i.addEventListener("click",(function(){A(d)})),d.addEventListener("click",(function(t){U(t,d)})),f.addEventListener("click",(function(){A(l)})),l.addEventListener("click",(function(t){U(t,l)})),u.addEventListener("click",(function(t){U(t,u)})),s.addEventListener("click",(function(t){U(t,s)})),p.addEventListener("submit",(function(n){n.preventDefault();var o=n.submitter,r=o.textContent;o.textContent="Сохранение...",function(e,n){return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:e.value,about:n.value})})}(b,S).then(e).then((function(t){m.textContent=t.name,v.textContent=t.about,w(a)})).catch((function(t){console.log(t)})).finally((function(){o.textContent=r}))})),d.addEventListener("submit",(function(n){n.preventDefault();var o=n.submitter,r=o.textContent;o.textContent="Сохранение...",function(e){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e.value})})}(g).then(e).then((function(t){E.src=t.avatar,w(d)})).catch((function(t){console.log(t)})).finally((function(){o.textContent=r}))})),h.addEventListener("submit",(function(n){n.preventDefault();var o,r,c=h.elements.place,i=h.elements.url,a=n.submitter,u=a.textContent;a.textContent="Сохранение...",(o=c,r=i,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:o.value,link:r.value})})).then(e).then((function(t){j(T(t.name,t.link,t.owner._id,t.owner._id,t._id,t.likes.length,t.likes),C),w(l),c.value="",i.value="";var e=Array.from(h.querySelectorAll(".form__item"));O(e,a,k)})).catch((function(t){console.log(t)})).finally((function(){a.textContent=u}))})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);O(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.valid?function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r,e),O(n,o,e)}))}))}(e,t)}))}(k)})();