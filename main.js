(()=>{"use strict";var t={baseUrl:"https://nomoreparties.co/v1/plus-cohort-9",headers:{authorization:"178f9d6a-33c6-4fd5-a1f0-54c79917b762","Content-Type":"application/json"}},e=new Promise((function(e,n){fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){e(t)})).catch((function(t){console.log(t),n()}))})),n=new Promise((function(e,n){fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){e(t)})).catch((function(t){console.log(t),n()}))})),o=document.querySelector(".page"),r=o.querySelector(".profile__toggle"),c=o.querySelector(".profile__avatar-container"),a=o.querySelector(".popup_type_profile"),i=o.querySelector(".popup_type_add-pic"),u=o.querySelector(".popup_type_full-pic"),s=o.querySelector(".popup_type_delete-pic"),l=o.querySelector(".popup_type_add-avatar"),d=o.querySelector(".profile__add-button"),f=document.forms.profile,p=document.forms.card,m=document.forms.avatar,h=o.querySelector(".profile__title"),_=o.querySelector(".profile__subtitle"),v=o.querySelector(".profile__avatar"),y=f.elements.name,b=f.elements.job,S=m.elements.url,g=o.querySelector(".photo-grid__list"),C=o.querySelector(".card-template").content,k=o.querySelector(".form__button_small"),L=o.querySelector(".profile__avatar"),q=(o.querySelectorAll(".form__button"),{formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_inactive",inputErrorClass:"form__item_type_error",errorClass:"form__item-error_active"});function E(t){"Escape"===t.key&&j(document.querySelector(".popup_opened"))}function x(t){t.classList.add("popup_opened"),document.addEventListener("keydown",E)}function j(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",E)}function A(t,e){(t.target.classList.contains("popup")||t.target.classList.contains("popup__toggle"))&&j(e)}function P(e,n,o,r,c,a){var i=C.querySelector(".photo-grid__card").cloneNode(!0),l=i.querySelector(".photo-grid__image"),d=i.querySelector(".photo-grid__title"),f=i.querySelector(".photo-grid__button"),p=i.querySelector(".photo-grid__trash"),m=i.querySelector(".photo-grid__like"),h=u.querySelector(".popup__image"),_=u.querySelector(".popup__title");return l.src=n,l.alt=e,d.textContent=e,m.textContent=a,o!==r?p.classList.add("photo-grid__trash_inactive"):p.addEventListener("click",(function(){x(s),function(e,n){k.addEventListener("click",(function(){(function(e,n){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers})})(e).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(){n.remove()})).catch((function(t){console.log(t)})),j(s)}))}(c,i)})),f.addEventListener("click",(function(){(function(e,n,o){o.classList.contains("photo-grid__button_active")?function(e,n){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers})}(e).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){n.textContent=t.likes.length})).catch((function(t){console.log(t)})):function(e,n){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers})}(e).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){n.textContent=t.likes.length})).catch((function(t){console.log(t)}))})(c,m,f),f.classList.toggle("photo-grid__button_active")})),l.addEventListener("click",(function(){x(u),h.src=l.src,h.alt=l.alt,_.textContent=l.alt})),i}function w(t,e){e.prepend(t)}var U=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(n.inactiveButtonClass),e.removeAttribute("disabled")):(e.classList.add(n.inactiveButtonClass),e.setAttribute("disabled",!0))};function T(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}Promise.all([e,n]).then((function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c=[],a=!0,i=!1;try{for(n=n.call(t);!(a=(o=n.next()).done)&&(c.push(o.value),!e||c.length!==e);a=!0);}catch(t){i=!0,r=t}finally{try{a||null==n.return||n.return()}finally{if(i)throw r}}return c}}(e,n)||function(t,e){if(t){if("string"==typeof t)return T(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],c=o[1];h.textContent=r.name,_.textContent=r.about,v.src=r.avatar;var a=r._id;c.reverse().forEach((function(t){w(P(t.name,t.link,t.owner._id,a,t._id,t.likes.length),g)}))})),r.addEventListener("click",(function(){x(a),y.value=h.textContent,b.value=_.textContent})),a.addEventListener("click",(function(t){A(t,a)})),c.addEventListener("click",(function(){x(l)})),l.addEventListener("click",(function(t){A(t,l)})),d.addEventListener("click",(function(){x(i)})),i.addEventListener("click",(function(t){A(t,i)})),u.addEventListener("click",(function(t){A(t,u)})),s.addEventListener("click",(function(t){A(t,s)})),f.addEventListener("submit",(function(e){e.preventDefault();var n=e.submitter,o=n.textContent;n.textContent="Сохранение...",function(e,n){return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:e.value,about:n.value})})}(y,b).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){h.textContent=t.name,_.textContent=t.about})).catch((function(t){console.log(t)})).finally((function(){n.textContent=o})),j(a)})),l.addEventListener("submit",(function(e){e.preventDefault();var n=e.submitter,o=n.textContent;n.textContent="Сохранение...",function(e){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e.value})})}(S).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){L.src=t.avatar})).catch((function(t){console.log(t)})).finally((function(){n.textContent=o})),j(l)})),p.addEventListener("submit",(function(e){e.preventDefault();var n,o,r=p.elements.place,c=p.elements.url,a=e.submitter,u=a.textContent;a.textContent="Сохранение...",(n=r,o=c,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:n.value,link:o.value})})).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){w(P(t.name,t.link,t.owner._id,t.owner._id,t._id,t.likes.length),g)})).catch((function(t){console.log(t)})).finally((function(){a.textContent=u})),j(i),r.value="",c.value="";var s=Array.from(p.querySelectorAll(".form__item"));U(s,a,q)})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);U(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.valid?function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r,e),U(n,o,e)}))}))}(e,t)}))}(q)})();